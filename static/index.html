<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Test Generator</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üéì LLM Test Generator</h1>
            <p>Generate and take AI-powered exams from educational content</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('upload')">üì§ Upload Files</button>
            <button class="tab" onclick="switchTab('generate')">‚öôÔ∏è Generate Exam</button>
            <button class="tab" onclick="switchTab('exams')">üìù My Exams</button>
            <button class="tab" onclick="switchTab('take')">‚úçÔ∏è Take Test</button>
        </div>

        <!-- Upload Tab -->
        <div id="upload-tab" class="tab-content active">
            <h2>Upload Markdown Files</h2>
            <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                <input type="file" id="fileInput" accept=".md" onchange="uploadFile(event)">
                <p style="font-size: 3em;">üìÑ</p>
                <p style="font-size: 18px; margin: 10px 0;">Click to upload or drag & drop</p>
                <p style="color: #666;">Only .md (Markdown) files accepted</p>
            </div>
            <div id="uploadResult"></div>
            <h3 style="margin-top: 30px;">Uploaded Files</h3>
            <div id="fileList" class="file-list"></div>
        </div>

        <!-- Generate Tab -->
        <div id="generate-tab" class="tab-content">
            <h2>Generate Exam</h2>
            <div>
                <label><strong>Select File:</strong></label>
                <select id="fileSelect" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 6px; border: 1px solid #ddd;">
                    <option value="">Choose a file...</option>
                </select>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); gap: 16px; margin: 20px 0;">
                <div>
                    <label><strong>Difficulty:</strong></label>
                    <select id="difficulty" style="width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ddd;">
                        <option value="mixed">Mixed</option>
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
                <div>
                    <label><strong>Language:</strong></label>
                    <select id="language" style="width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ddd;">
                        <option value="en">English</option>
                        <option value="ru">–†—É—Å—Å–∫–∏–π (Russian)</option>
                    </select>
                </div>
                <div>
                    <label><strong>Provider:</strong></label>
                    <select id="provider" style="width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ddd;">
                        <option value="openai">OpenAI</option>
                        <option value="yandex">Yandex</option>
                        <option value="local">Local (stub)</option>
                    </select>
                </div>
                <div>
                    <label><strong>Model (optional):</strong></label>
                    <input id="modelName" type="text" placeholder="gpt-4o-mini / yandexgpt-lite"
                           style="width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ddd;">
                </div>
            </div>

            <h3 style="margin: 20px 0;">Question Type Distribution</h3>
            <div class="count-control">
                <label><strong>Single Choice Questions:</strong></label>
                <input type="number" id="singleCount" min="0" max="100" value="10"
                       oninput="updateTotal()" style="width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ddd;">
            </div>
            <div class="count-control">
                <label><strong>Multiple Choice Questions:</strong></label>
                <input type="number" id="multipleCount" min="0" max="100" value="6"
                       oninput="updateTotal()" style="width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ddd;">
            </div>
            <div class="count-control">
                <label><strong>Open-Ended Questions:</strong></label>
                <input type="number" id="openCount" min="0" max="100" value="4"
                       oninput="updateTotal()" style="width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; border: 1px solid #ddd;">
            </div>
            <div style="background-color: #e8f5e9; padding: 15px; border-radius: 6px; margin-top: 15px;">
                <p style="margin: 0; font-size: 16px;">
                    üìä <strong>Total Questions:</strong> <span id="totalQuestionsDisplay" style="font-size: 20px; color: #2e7d32;">20</span>
                </p>
                <p style="color: #666; font-size: 13px; margin: 5px 0 0 0;">
                    ‚ÑπÔ∏è Specify exact counts for each question type
                </p>
            </div>

            <button class="btn" onclick="generateExam()">üöÄ Generate Exam</button>
            <div id="generateResult"></div>
        </div>

        <!-- Exams Tab -->
        <div id="exams-tab" class="tab-content">
            <h2>Generated Exams</h2>
            <div style="display:flex; gap:10px; flex-wrap: wrap; align-items:center;">
                <button class="btn" onclick="loadExams()">üîÑ Refresh</button>
                <label>Sort by:
                    <select id="examSort" onchange="changeExamSort()" style="padding:8px; border-radius:6px; border:1px solid #ddd;">
                        <option value="created">Date</option>
                        <option value="size">Size</option>
                        <option value="exam_id">Name</option>
                    </select>
                </label>
                <label>Order:
                    <select id="examOrder" onchange="changeExamSort()" style="padding:8px; border-radius:6px; border:1px solid #ddd;">
                        <option value="desc">Desc</option>
                        <option value="asc">Asc</option>
                    </select>
                </label>
                <label>Page size:
                    <input id="examPageSize" type="number" value="10" min="1" max="100" onchange="changeExamSort()" style="width:70px; padding:8px; border-radius:6px; border:1px solid #ddd;">
                </label>
            </div>
            <div class="card" style="margin: 16px 0;">
                <h3>üì• Import Existing Exam</h3>
                <p style="color: var(--muted); font-size: 14px;">Paste exam JSON to register it in storage.</p>
                <textarea id="importText" class="text-answer" placeholder='{"exam_id":"ex-123",...}' style="min-height: 120px;"></textarea>
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button class="btn" onclick="importExam()">Import</button>
                    <button class="btn secondary" onclick="document.getElementById('importText').value=''">Clear</button>
                </div>
                <div id="importResult"></div>
            </div>
            <div id="examList"></div>
            <div id="examPagination" style="margin-top:12px; display:flex; align-items:center; gap:10px;">
                <button class="btn secondary" onclick="prevExamPage()">Prev</button>
                <span id="examPageInfo" style="color: var(--muted);"></span>
                <button class="btn secondary" onclick="nextExamPage()">Next</button>
            </div>
        </div>

        <!-- Take Test Tab -->
        <div id="take-tab" class="tab-content">
            <h2>Take Test</h2>
            <div>
                <label><strong>Select Exam:</strong></label>
                <select id="examSelect" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 6px; border: 1px solid #ddd;">
                    <option value="">Choose an exam...</option>
                </select>
                <button class="btn" onclick="loadExamForTest()">üìñ Load Exam</button>
            </div>
            <div id="testContent"></div>
            <div id="testResult"></div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="/js/api-client.js"></script>
    <script src="/js/ui-utils.js"></script>
    <script src="/js/file-manager.js"></script>
    <script src="/js/exam-manager.js"></script>
    <script src="/js/test-taker.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>
